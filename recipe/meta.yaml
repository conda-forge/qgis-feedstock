{% set name = "qgis" %}
{% set version = "3.0.3" %}

package:
  name: qgis
  version: {{ version }}

source:
  url: https://qgis.org/downloads/{{ name }}-{{ version }}.tar.bz2
  sha256: b647468a3c7b78a25fee19a731c6bcf1efc6c1ebc98780d071573561e7abd2a7
  patches:
    # QGIS inserts Qt plugin locations into PATH relative to build location
    # This patch fixes it so PATH is relative to install location
    - plugins_path.patch  # [linux]
    # by default looks for pyrcc5.bat on Windows, but we have pyrcc5.exe
    - pyrcc.patch  # [win]
    # spatialindex.lib is weirdly named on Windows
    - spatialindex.patch  # [win]
    # gets the wrong geos lib
    - geoscmake.patch  # [win]
    # don't try and install MSVC runtime libs as they already exist
    - CMakeLists.nosyslibs.patch  # [win]

build:
  number: 0
  skip: true  # [osx or py2k]
  features:
    - vc9  # [win and py27]
    - vc10  # [win and py34]
    - vc14  # [win and py>=35]

requirements:
  build:
    - python
    - six
    - toolchain
    - cmake
    - ninja
    - flex  # [unix]
    - m2-flex  # [win]
    - bison  # [unix]
    - m2-bison  # [win]
    - m4  # [unix]
    - m2-m4  # [win]
    - sip
    - expat 2.2.*
    - icu 58.*
    - libzip
    - libtasn1  # [osx]
    # Qt stack.
    - qt 5.6.*
    - pyqt 5.6.*
    - qtwebkit  # [osx]
    - qscintilla2
    - qca
    - qjson
    - qwt
    - qwtpolar
    - qtkeychain
    - qtlocation
    # GDAL stack.
    - gdal 2.2.*
    - geos 3.6.2
    - proj4 4.9.3
    # GSL for georeferencer.
    - gsl
    - sqlite 3.20.*
    - libspatialindex
    - libspatialite
    # For PostgreSQL support.
    - postgresql
    - psycopg2
    - vc 9  # [win and py27]
    - vc 10  # [win and py34]
    - vc 14  # [win and py>=35]
  run:
    - python
    - icu 58.*
    - libzip
    - libtasn1  # [osx]
    - qt 5.6.*
    - pyqt 5.6.*
    - qtwebkit  # [osx]
    - qscintilla2
    - qca
    - qjson
    - qwt
    - qwtpolar
    - qtkeychain
    - qtlocation
    - gdal 2.2.*
    - geos 3.6.2
    - proj4 4.9.3
    - gsl
    - sqlite 3.20.*
    - libspatialindex
    - libspatialite
    - psycopg2
    - postgresql
    # Runtime Python library deps
    - python-dateutil
    - future
    - httplib2
    - jinja2
    - markupsafe
    - mock
    - nose
    - owslib
    - plotly
    - pygments
    - pyproj
    - requests
    - six
    - sip
    - pytz
    - pyyaml
    - yaml
    - vc 9  # [win and py27]
    - vc 10  # [win and py34]
    - vc 14  # [win and py>=35]

test:
  commands:
    # cannot execute this at the moment:
    # raise ImportError('This package should not be accessible on Python 3.
    # - conda inspect linkages -p $PREFIX $PKG_NAME  # [not win]
    - conda inspect objects -p $PREFIX $PKG_NAME  # [osx]

about:
  home: http://qgis.org/
  license: GPL-2.0
  license_file: COPYING
  summary: 'A free and open source Geographic Information System (GIS).'
  description: |
    QGIS is a user friendly Open Source Geographic Information System (GIS)
    licensed under the GNU General Public License. QGIS is an official
    project of the Open Source Geospatial Foundation (OSGeo). It runs on
    Linux, Unix, Mac OSX, Windows and Android and supports numerous vector,
    raster, and database formats and functionalities.
  doc_url: https://www.qgis.org/en/docs/index.html
  dev_url: https://github.com/qgis/QGIS

extra:
  recipe-maintainers:
    - ceholden
    - ocefpaf
